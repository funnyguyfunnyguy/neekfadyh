<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>neekingFadyH</title>
  <style>
    * {
      margin: 0; 
      padding: 0;
      box-sizing: border-box;
    }

    body {
      min-height: 100vh;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      padding-bottom: 100px;
    }

    h1 {
      font-size: 3rem;
      color: #e94560;
      text-shadow: 0 0 20px rgba(233, 69, 96, 0.5);
      margin-bottom: 10px;
      text-align: center;
    }

    .subtitle {
      color: #a0a0a0;
      font-size: 1rem;
      margin-bottom: 30px;
      font-style: italic;
    }

    /* Auth Section */
    .auth-section {
      margin-bottom: 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      background: rgba(255,255,255,0.05);
      padding: 30px;
      border-radius: 15px;
      border: 1px solid rgba(233, 69, 96, 0.3);
      width: 100%;
      max-width: 350px;
    }

    .auth-section.hidden {
      display: none;
    }

    .auth-title {
      color: #e94560;
      font-size: 1.3rem;
      margin-bottom: 5px;
    }

    .auth-input {
      background: #1a1a1a;
      border: 2px solid #333;
      color: #fff;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 1rem;
      outline: none;
      width: 100%;
      transition: border-color 0.2s;
    }

    .auth-input:focus {
      border-color: #e94560;
    }

    .auth-input::placeholder {
      color: #666;
    }

    .auth-btn {
      background: linear-gradient(145deg, #e94560, #ff6b6b);
      border: none;
      color: white;
      padding: 12px 30px;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
      width: 100%;
    }

    .auth-btn:hover {
      transform: scale(1.02);
      box-shadow: 0 5px 20px rgba(233, 69, 96, 0.4);
    }

    .auth-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .auth-switch {
      color: #888;
      font-size: 0.9rem;
    }

    .auth-switch button {
      background: none;
      border: none;
      color: #e94560;
      cursor: pointer;
      text-decoration: underline;
      font-size: 0.9rem;
    }

    .auth-error {
      color: #ff4444;
      font-size: 0.85rem;
      text-align: center;
      min-height: 20px;
    }

    .auth-divider {
      color: #555;
      font-size: 0.8rem;
      margin: 5px 0;
    }

    /* User Welcome */
    .user-welcome {
      margin-bottom: 20px;
      text-align: center;
    }

    .user-welcome.hidden {
      display: none;
    }

    .welcome-text {
      color: #fff;
      font-size: 1.2rem;
    }

    .user-name {
      color: #e94560;
      font-weight: bold;
    }

    .your-neeks {
      color: #a0a0a0;
      font-size: 0.9rem;
      margin-top: 5px;
    }

    .your-neeks-count {
      color: #4ade80;
      font-weight: bold;
    }

    .logout-btn {
      background: transparent;
      border: none;
      color: #555;
      font-size: 0.75rem;
      cursor: pointer;
      text-decoration: underline;
      margin-top: 5px;
    }

    .neek-button {
      width: 280px;
      height: 280px;
      border-radius: 50%;
      background: linear-gradient(145deg, #e94560, #ff6b6b);
      border: none;
      cursor: pointer;
      font-size: 2rem;
      font-weight: bold;
      color: white;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      box-shadow: 0 10px 40px rgba(233, 69, 96, 0.4), 0 0 60px rgba(233, 69, 96, 0.2);
      transition: all 0.15s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      line-height: 1.2;
      text-align: center;
      padding: 20px;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }

    .neek-button:hover {
      transform: scale(1.05);
      box-shadow: 0 15px 50px rgba(233, 69, 96, 0.5), 0 0 80px rgba(233, 69, 96, 0.3);
    }

    .neek-button:active, .neek-button.clicking {
      transform: scale(0.95);
      background: linear-gradient(145deg, #b8354a, #e94560);
      box-shadow: inset 5px 5px 15px rgba(0,0,0,0.3), 0 0 30px rgba(233, 69, 96, 0.6);
    }

    .neek-button.disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .counter-box {
      margin-top: 40px;
      padding: 25px 50px;
      background: rgba(255,255,255,0.05);
      border-radius: 15px;
      border: 1px solid rgba(233, 69, 96, 0.3);
      backdrop-filter: blur(10px);
    }

    .counter-text {
      color: #ffffff;
      font-size: 1.5rem;
      text-align: center;
    }

    .counter-number {
      color: #e94560;
      font-weight: bold;
      font-size: 2rem;
      text-shadow: 0 0 10px rgba(233, 69, 96, 0.5);
    }

    .loading {
      color: #a0a0a0;
    }

    /* Leaderboard */
    .leaderboard {
      margin-top: 40px;
      width: 100%;
      max-width: 400px;
    }

    .leaderboard-title {
      color: #e94560;
      font-size: 1.5rem;
      text-align: center;
      margin-bottom: 15px;
    }

    .leaderboard-list {
      background: rgba(255,255,255,0.05);
      border-radius: 15px;
      border: 1px solid rgba(233, 69, 96, 0.2);
      overflow: hidden;
    }

    .leaderboard-item {
      display: flex;
      align-items: center;
      padding: 12px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }

    .leaderboard-item:last-child {
      border-bottom: none;
    }

    .leaderboard-rank {
      width: 30px;
      font-weight: bold;
      color: #888;
    }

    .leaderboard-rank.gold {
      color: #ffd700;
    }

    .leaderboard-rank.silver {
      color: #c0c0c0;
    }

    .leaderboard-rank.bronze {
      color: #cd7f32;
    }

    .leaderboard-name {
      flex: 1;
      color: #fff;
    }

    .leaderboard-name.you {
      color: #4ade80;
    }

    .leaderboard-score {
      color: #e94560;
      font-weight: bold;
    }

    .no-users {
      color: #666;
      text-align: center;
      padding: 20px;
      font-style: italic;
    }

    .footer {
      position: fixed;
      bottom: 20px;
      color: #505050;
      font-size: 0.8rem;
    }

    .admin-section {
      position: fixed;
      bottom: 60px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    .admin-link {
      background: transparent;
      border: none;
      color: #404040;
      font-size: 0.75rem;
      cursor: pointer;
      text-decoration: underline;
    }

    .reset-panel {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      padding: 15px 25px;
      background: rgba(0,0,0,0.5);
      border-radius: 10px;
      border: 1px solid #333;
    }

    .reset-panel.error {
      border-color: #ff4444;
    }

    .password-input {
      background: #1a1a1a;
      border: 1px solid #444;
      color: #fff;
      padding: 8px 12px;
      border-radius: 5px;
      font-size: 0.9rem;
      text-align: center;
      outline: none;
      width: 150px;
    }

    .password-input.error {
      border-color: #ff4444;
    }

    .error-text {
      color: #ff4444;
      font-size: 0.75rem;
    }

    .button-row {
      display: flex;
      gap: 10px;
    }

    .reset-btn {
      background: #333;
      border: 1px solid #555;
      color: #ff4444;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.85rem;
      font-weight: bold;
    }

    .cancel-btn {
      background: #222;
      border: 1px solid #444;
      color: #888;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.85rem;
    }

    .hidden {
      display: none !important;
    }

    /* Update notification popup */
    .update-popup {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      padding: 20px;
    }

    .update-popup.hidden {
      display: none;
    }

    .update-content {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      border: 2px solid #e94560;
      border-radius: 20px;
      padding: 30px;
      max-width: 500px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 0 50px rgba(233, 69, 96, 0.3);
    }

    .update-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
    }

    .update-icon {
      font-size: 2rem;
    }

    .update-title {
      color: #e94560;
      font-size: 1.5rem;
      margin: 0;
    }

    .update-list {
      list-style: none;
      padding: 0;
      margin: 0 0 20px 0;
    }

    .update-item {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 10px;
      border-left: 3px solid #e94560;
    }

    .update-message {
      color: #fff;
      font-size: 1rem;
      margin: 0 0 8px 0;
    }

    .update-date {
      color: #666;
      font-size: 0.8rem;
    }

    .update-close-btn {
      background: linear-gradient(145deg, #e94560, #ff6b6b);
      border: none;
      color: white;
      padding: 12px 30px;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
      transition: all 0.2s;
    }

    .update-close-btn:hover {
      transform: scale(1.02);
      box-shadow: 0 5px 20px rgba(233, 69, 96, 0.4);
    }

    .no-updates {
      color: #888;
      text-align: center;
      font-style: italic;
      padding: 20px 0;
    }

    /* Time online display */
    .time-online {
      color: #666;
      font-size: 0.8rem;
      margin-top: 5px;
    }

    .time-online-value {
      color: #4ade80;
    }

    /* Update bell button */
    .update-bell {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(233, 69, 96, 0.2);
      border: 1px solid #e94560;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 1.5rem;
      transition: all 0.2s;
    }

    .update-bell:hover {
      background: rgba(233, 69, 96, 0.4);
      transform: scale(1.1);
    }

    .update-bell-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #e94560;
      color: white;
      font-size: 0.7rem;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    .update-bell-badge.hidden {
      display: none;
    }

    /* Prestige badges */
    .prestige-badge {
      margin-left: 5px;
      font-size: 0.9em;
    }

    .prestige-info {
      color: #666;
      font-size: 0.8rem;
      margin-top: 8px;
    }

    .prestige-progress {
      width: 150px;
      height: 6px;
      background: #333;
      border-radius: 3px;
      margin-top: 5px;
      overflow: hidden;
    }

    .prestige-progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #e94560, #ff6b6b);
      border-radius: 3px;
      transition: width 0.3s ease;
    }

    .next-prestige {
      color: #888;
      font-size: 0.75rem;
      margin-top: 3px;
    }

    /* Loading overlay */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .loading-overlay.hidden {
      display: none;
    }

    .loading-spinner {
      color: #e94560;
      font-size: 1.5rem;
    }
  </style>
</head>
<body>
  <!-- Loading overlay while checking auth state -->
  <div class="loading-overlay" id="loadingOverlay">
    <p class="loading-spinner">Loading...</p>
  </div>

  <!-- Update notification popup -->
  <div class="update-popup hidden" id="updatePopup">
    <div class="update-content">
      <div class="update-header">
        <span class="update-icon">üéâ</span>
        <h2 class="update-title">What's New!</h2>
      </div>
      <ul class="update-list" id="updateList">
        <p class="no-updates">Loading updates...</p>
      </ul>
      <button class="update-close-btn" onclick="closeUpdatePopup()">Got it!</button>
    </div>
  </div>

  <!-- Update bell button -->
  <button class="update-bell" onclick="showUpdatePopup()">
    üîî
    <span class="update-bell-badge hidden" id="updateBadge">!</span>
  </button>

  <h1>neekingFadyH</h1>
  <p class="subtitle">A sacred place for neeking</p>

  <!-- Auth Section (Login/Signup) -->
  <div class="auth-section" id="authSection">
    <h2 class="auth-title" id="authTitle">Sign Up</h2>
    
    <input 
      type="text" 
      class="auth-input" 
      id="displayNameInput" 
      placeholder="Display Name"
      maxlength="20"
    >
    
    <input 
      type="email" 
      class="auth-input" 
      id="emailInput" 
      placeholder="Email"
    >
    
    <input 
      type="password" 
      class="auth-input" 
      id="authPasswordInput" 
      placeholder="Password (min 6 characters)"
      onkeydown="if(event.key === 'Enter') handleAuth()"
    >
    
    <p class="auth-error" id="authError"></p>
    
    <button class="auth-btn" id="authBtn" onclick="handleAuth()">Sign Up</button>
    
    <p class="auth-switch">
      <span id="switchText">Already have an account?</span>
      <button onclick="toggleAuthMode()" id="switchBtn">Log In</button>
    </p>
  </div>

  <!-- User Welcome (shown after login) -->
  <div class="user-welcome hidden" id="userWelcome">
    <p class="welcome-text">Welcome, <span class="user-name" id="displayName"></span><span class="prestige-badge" id="userPrestigeBadge"></span></p>
    <p class="your-neeks">Your neeks: <span class="your-neeks-count" id="yourNeeks">0</span></p>
    <p class="time-online">Total time online: <span class="time-online-value" id="timeOnline">0:00:00</span></p>
    <div class="prestige-info">
      <div class="prestige-progress">
        <div class="prestige-progress-bar" id="prestigeProgress" style="width: 0%"></div>
      </div>
      <p class="next-prestige" id="nextPrestigeText">100 neeks until next prestige</p>
    </div>
    <button class="logout-btn" onclick="handleLogout()">logout</button>
  </div>

  <button class="neek-button disabled" id="neekBtn" onclick="handleNeek()">
    NEEK<br>FADY H
  </button>

  <div class="counter-box">
    <p class="counter-text">
      <span id="loadingText" class="loading">Loading...</span>
      <span id="counterText" class="hidden">
        FadyH has been neeked <span class="counter-number" id="countNumber">0</span> times
      </span>
    </p>
  </div>

  <!-- Leaderboard -->
  <div class="leaderboard">
    <h2 class="leaderboard-title">üèÜ Top Neekers</h2>
    <div class="leaderboard-list" id="leaderboardList">
      <p class="no-users">No neekers yet...</p>
    </div>
  </div>

  <div class="admin-section">
    <button class="admin-link" id="adminLink" onclick="showResetPanel()">admin options</button>
    
    <div class="reset-panel hidden" id="resetPanel">
      <input 
        type="password" 
        class="password-input" 
        id="resetPasswordInput" 
        placeholder="Enter password"
        onkeydown="if(event.key === 'Enter') handleReset()"
      >
      <span class="error-text hidden" id="errorText">Wrong password!</span>
      <div class="button-row">
        <button class="reset-btn" onclick="handleReset()">üîÑ Reset All</button>
        <button class="cancel-btn" onclick="hideResetPanel()">Cancel</button>
      </div>
    </div>
  </div>

  <p class="footer">üî¥ Log in to start neeking</p>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // ===========================================
      // üîß FIREBASE CONFIGURATION
      // ===========================================
      const firebaseConfig = {
        apiKey: "AIzaSyCRi-9QN_sbLrXMRZP1Z8kqh-CIyybX7-o",
        authDomain: "neekfadyh.firebaseapp.com",
        databaseURL: "https://neekfadyh-default-rtdb.firebaseio.com",
        projectId: "neekfadyh",
        storageBucket: "neekfadyh.firebasestorage.app",
        messagingSenderId: "146393405071",
        appId: "1:146393405071:web:b8a03bccf6ba59f2df02fa"
      };

      const RESET_PASSWORD = "GDUB";
      
      // ===========================================
      // üîî GITHUB UPDATE NOTIFICATIONS CONFIG
      // ===========================================
      const GITHUB_USERNAME = "funnyguyfunnyguy"; // ‚Üê Change this!
      const GITHUB_REPO = "neekfadyh";
      const MAX_COMMITS_TO_SHOW = 5;
      // ===========================================

      let timeOnlineInterval = null;
      let saveTimeInterval = null;
      // ===========================================

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
      const database = firebase.database();
      const counterRef = database.ref('neekCounter');
      const usersRef = database.ref('users');

      let currentUser = null;
      let isSignUpMode = true;
      let isClicking = false;

      // ===========================================
      // üö´ AUTOCLICKER DETECTION
      // ===========================================
      const clickTimes = [];
      const MAX_CLICKS_TRACKED = 20;
      const MIN_CLICK_INTERVAL = 80; // Minimum ms between clicks (human limit ~100ms)
      const SUSPICION_THRESHOLD = 5; // Consecutive fast clicks before flagged
      const VARIANCE_THRESHOLD = 15; // If timing variance is too low, it's a bot
      const COOLDOWN_TIME = 3000; // 3 second cooldown when caught
      let suspicionCount = 0;
      let isCoolingDown = false;
      let cooldownEndTime = 0;

      function detectAutoclicker() {
        const now = Date.now();
        clickTimes.push(now);
        
        // Keep only recent clicks
        if (clickTimes.length > MAX_CLICKS_TRACKED) {
          clickTimes.shift();
        }
        
        if (clickTimes.length < 3) return false;
        
        // Check 1: Minimum interval between clicks
        const lastInterval = clickTimes[clickTimes.length - 1] - clickTimes[clickTimes.length - 2];
        if (lastInterval < MIN_CLICK_INTERVAL) {
          suspicionCount++;
          if (suspicionCount >= SUSPICION_THRESHOLD) {
            return true; // Too many fast clicks
          }
        } else {
          suspicionCount = Math.max(0, suspicionCount - 1); // Decay suspicion
        }
        
        // Check 2: Variance in click timing (bots have very consistent timing)
        if (clickTimes.length >= 10) {
          const intervals = [];
          for (let i = 1; i < clickTimes.length; i++) {
            intervals.push(clickTimes[i] - clickTimes[i - 1]);
          }
          
          const avgInterval = intervals.reduce((a, b) => a + b, 0) / intervals.length;
          const variance = intervals.reduce((sum, val) => sum + Math.pow(val - avgInterval, 2), 0) / intervals.length;
          const stdDev = Math.sqrt(variance);
          
          // Humans have natural variance; bots don't
          if (stdDev < VARIANCE_THRESHOLD && avgInterval < 200) {
            return true; // Too consistent = bot
          }
        }
        
        return false;
      }

      function triggerCooldown() {
        isCoolingDown = true;
        cooldownEndTime = Date.now() + COOLDOWN_TIME;
        suspicionCount = 0;
        clickTimes.length = 0;
        
        const btn = document.getElementById('neekBtn');
        btn.style.background = 'linear-gradient(145deg, #666, #888)';
        btn.innerHTML = 'üö´<br>COOLDOWN';
        
        const countdownInterval = setInterval(() => {
          const remaining = Math.ceil((cooldownEndTime - Date.now()) / 1000);
          if (remaining > 0) {
            btn.innerHTML = 'üö´<br>' + remaining + 's';
          } else {
            clearInterval(countdownInterval);
            isCoolingDown = false;
            btn.style.background = 'linear-gradient(145deg, #e94560, #ff6b6b)';
            btn.innerHTML = 'NEEK<br>FADY H';
          }
        }, 100);
      }

      // ===========================================
      // üèÜ PRESTIGE SYSTEM
      // ===========================================
      const PRESTIGE_LEVELS = [
        { min: 0, badge: '', title: 'Newcomer' },
        { min: 100, badge: '‚≠ê', title: 'Neeker' },
        { min: 200, badge: '‚≠ê‚≠ê', title: 'Pro Neeker' },
        { min: 300, badge: 'üåü', title: 'Super Neeker' },
        { min: 500, badge: 'üåü‚≠ê', title: 'Ultra Neeker' },
        { min: 750, badge: 'üåüüåü', title: 'Mega Neeker' },
        { min: 1000, badge: 'üí´', title: 'Elite Neeker' },
        { min: 1500, badge: 'üí´‚≠ê', title: 'Master Neeker' },
        { min: 2000, badge: 'üí´üåü', title: 'Grandmaster' },
        { min: 3000, badge: '‚ú®', title: 'Legend' },
        { min: 5000, badge: '‚ú®üí´', title: 'Mythic' },
        { min: 7500, badge: 'üëë', title: 'Neek Royalty' },
        { min: 10000, badge: 'üëë‚ú®', title: 'Neek God' },
        { min: 100000, badge: 'üï∫', title: 'THE FADYH' },
      ];

      function getPrestigeInfo(neeks) {
        let currentLevel = PRESTIGE_LEVELS[0];
        let nextLevel = PRESTIGE_LEVELS[1];
        
        for (let i = PRESTIGE_LEVELS.length - 1; i >= 0; i--) {
          if (neeks >= PRESTIGE_LEVELS[i].min) {
            currentLevel = PRESTIGE_LEVELS[i];
            nextLevel = PRESTIGE_LEVELS[i + 1] || null;
            break;
          }
        }
        
        let progress = 0;
        let neeksToNext = 0;
        
        if (nextLevel) {
          const levelRange = nextLevel.min - currentLevel.min;
          const neeksInLevel = neeks - currentLevel.min;
          progress = (neeksInLevel / levelRange) * 100;
          neeksToNext = nextLevel.min - neeks;
        } else {
          progress = 100; // Max level
        }
        
        return {
          badge: currentLevel.badge,
          title: currentLevel.title,
          progress: Math.min(progress, 100),
          neeksToNext: neeksToNext,
          nextLevel: nextLevel,
          isMaxLevel: !nextLevel
        };
      }

      function updatePrestigeDisplay(neeks) {
        const info = getPrestigeInfo(neeks);
        
        document.getElementById('userPrestigeBadge').textContent = info.badge;
        document.getElementById('prestigeProgress').style.width = info.progress + '%';
        
        if (info.isMaxLevel) {
          document.getElementById('nextPrestigeText').textContent = 'üéâ MAX PRESTIGE - ' + info.title;
        } else {
          document.getElementById('nextPrestigeText').textContent = 
            info.neeksToNext + ' neeks until ' + info.nextLevel.badge + ' ' + info.nextLevel.title;
        }
      }

      // ===========================================
      // üîî UPDATE NOTIFICATIONS SYSTEM
      // ===========================================
      async function fetchGitHubCommits() {
        try {
          const response = await fetch(
            `https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/commits?per_page=${MAX_COMMITS_TO_SHOW}`
          );
          
          if (!response.ok) throw new Error('Failed to fetch');
          
          const commits = await response.json();
          return commits.map(commit => ({
            message: commit.commit.message,
            date: new Date(commit.commit.author.date),
            sha: commit.sha
          }));
        } catch (error) {
          console.error('Failed to fetch commits:', error);
          return [];
        }
      }

      function formatTimeAgo(date) {
        const seconds = Math.floor((new Date() - date) / 1000);
        
        if (seconds < 60) return 'just now';
        if (seconds < 3600) return Math.floor(seconds / 60) + ' minutes ago';
        if (seconds < 86400) return Math.floor(seconds / 3600) + ' hours ago';
        if (seconds < 604800) return Math.floor(seconds / 86400) + ' days ago';
        return date.toLocaleDateString();
      }

      async function loadUpdates() {
        const commits = await fetchGitHubCommits();
        const list = document.getElementById('updateList');
        
        if (commits.length === 0) {
          list.innerHTML = '<p class="no-updates">No updates available</p>';
          return;
        }
        
        // Check if there are new updates since last visit
        const lastSeenCommit = localStorage.getItem('lastSeenCommit');
        if (lastSeenCommit !== commits[0].sha) {
          document.getElementById('updateBadge').classList.remove('hidden');
        }
        
        list.innerHTML = commits.map(commit => `
          <li class="update-item">
            <p class="update-message">${commit.message}</p>
            <p class="update-date">${formatTimeAgo(commit.date)}</p>
          </li>
        `).join('');
      }

      window.showUpdatePopup = function() {
        document.getElementById('updatePopup').classList.remove('hidden');
      }

      window.closeUpdatePopup = async function() {
        document.getElementById('updatePopup').classList.add('hidden');
        document.getElementById('updateBadge').classList.add('hidden');
        
        // Mark latest commit as seen
        const commits = await fetchGitHubCommits();
        if (commits.length > 0) {
          localStorage.setItem('lastSeenCommit', commits[0].sha);
        }
      }

      // ===========================================
      // ‚è±Ô∏è TIME ONLINE TRACKING
      // ===========================================
      function formatTime(totalSeconds) {
        const hours = Math.floor(totalSeconds / 3600);
        const minutes = Math.floor((totalSeconds % 3600) / 60);
        const seconds = totalSeconds % 60;
        
        return `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      }

      function startTimeTracking() {
        if (!currentUser) return;
        
        let localTimeOnline = 0;
        
        // Load initial time from Firebase
        usersRef.child(currentUser.uid).child('timeOnline').once('value', (snapshot) => {
          localTimeOnline = snapshot.val() || 0;
          document.getElementById('timeOnline').textContent = formatTime(localTimeOnline);
        });
        
        // Update display every second
        timeOnlineInterval = setInterval(() => {
          localTimeOnline++;
          document.getElementById('timeOnline').textContent = formatTime(localTimeOnline);
        }, 1000);
        
        // Save to Firebase every 30 seconds
        saveTimeInterval = setInterval(() => {
          if (currentUser) {
            usersRef.child(currentUser.uid).child('timeOnline').set(localTimeOnline);
          }
        }, 30000);
        
        // Save on page unload
        window.addEventListener('beforeunload', () => {
          if (currentUser) {
            usersRef.child(currentUser.uid).child('timeOnline').set(localTimeOnline);
          }
        });
      }

      function stopTimeTracking() {
        if (timeOnlineInterval) {
          clearInterval(timeOnlineInterval);
          timeOnlineInterval = null;
        }
        if (saveTimeInterval) {
          clearInterval(saveTimeInterval);
          saveTimeInterval = null;
        }
      }

      // Load updates on page load
      loadUpdates();

      // Listen for auth state changes
      auth.onAuthStateChanged((user) => {
        document.getElementById('loadingOverlay').classList.add('hidden');
        
        if (user) {
          currentUser = user;
          showLoggedInState();
          loadUserData();
        } else {
          currentUser = null;
          showLoggedOutState();
        }
      });

      // Load counter
      counterRef.on('value', (snapshot) => {
        const count = snapshot.val() || 0;
        document.getElementById('loadingText').classList.add('hidden');
        document.getElementById('counterText').classList.remove('hidden');
        document.getElementById('countNumber').textContent = count.toLocaleString();
      });

      // Load leaderboard
      usersRef.orderByChild('neeks').on('value', (snapshot) => {
        updateLeaderboard(snapshot);
      });

      function showLoggedInState() {
        document.getElementById('authSection').classList.add('hidden');
        document.getElementById('userWelcome').classList.remove('hidden');
        document.getElementById('neekBtn').classList.remove('disabled');
        document.querySelector('.footer').textContent = 'üî¥ Press the button to neek';
        startTimeTracking();
      }

      function showLoggedOutState() {
        document.getElementById('authSection').classList.remove('hidden');
        document.getElementById('userWelcome').classList.add('hidden');
        document.getElementById('neekBtn').classList.add('disabled');
        document.querySelector('.footer').textContent = 'üî¥ Log in to start neeking';
        document.getElementById('displayName').textContent = '';
        document.getElementById('yourNeeks').textContent = '0';
        document.getElementById('timeOnline').textContent = '0:00:00';
        stopTimeTracking();
      }

      function loadUserData() {
        if (!currentUser) return;
        
        usersRef.child(currentUser.uid).on('value', (snapshot) => {
          const userData = snapshot.val();
          if (userData) {
            const neeks = userData.neeks || 0;
            document.getElementById('displayName').textContent = userData.name || 'Neeker';
            document.getElementById('yourNeeks').textContent = neeks;
            updatePrestigeDisplay(neeks);
          }
        });
      }

      function updateLeaderboard(snapshot) {
        const users = snapshot.val();
        const list = document.getElementById('leaderboardList');
        
        if (!users) {
          list.innerHTML = '<p class="no-users">No neekers yet...</p>';
          return;
        }

        const sortedUsers = Object.entries(users)
          .map(([key, val]) => ({ key, ...val }))
          .filter(u => u.neeks > 0)
          .sort((a, b) => (b.neeks || 0) - (a.neeks || 0))
          .slice(0, 10);

        if (sortedUsers.length === 0) {
          list.innerHTML = '<p class="no-users">No neekers yet...</p>';
          return;
        }

        list.innerHTML = sortedUsers.map((user, index) => {
          const rankClass = index === 0 ? 'gold' : index === 1 ? 'silver' : index === 2 ? 'bronze' : '';
          const isYou = currentUser && user.key === currentUser.uid;
          const prestigeInfo = getPrestigeInfo(user.neeks || 0);
          return `
            <div class="leaderboard-item">
              <span class="leaderboard-rank ${rankClass}">#${index + 1}</span>
              <span class="leaderboard-name ${isYou ? 'you' : ''}">${user.name || 'Anonymous'}${prestigeInfo.badge ? ' ' + prestigeInfo.badge : ''}${isYou ? ' (you)' : ''}</span>
              <span class="leaderboard-score">${user.neeks || 0}</span>
            </div>
          `;
        }).join('');
      }

      window.toggleAuthMode = function() {
        isSignUpMode = !isSignUpMode;
        const title = document.getElementById('authTitle');
        const btn = document.getElementById('authBtn');
        const switchText = document.getElementById('switchText');
        const switchBtn = document.getElementById('switchBtn');
        const nameInput = document.getElementById('displayNameInput');
        
        if (isSignUpMode) {
          title.textContent = 'Sign Up';
          btn.textContent = 'Sign Up';
          switchText.textContent = 'Already have an account?';
          switchBtn.textContent = 'Log In';
          nameInput.classList.remove('hidden');
        } else {
          title.textContent = 'Log In';
          btn.textContent = 'Log In';
          switchText.textContent = "Don't have an account?";
          switchBtn.textContent = 'Sign Up';
          nameInput.classList.add('hidden');
        }
        
        document.getElementById('authError').textContent = '';
      }

      window.handleAuth = async function() {
        const email = document.getElementById('emailInput').value.trim();
        const password = document.getElementById('authPasswordInput').value;
        const displayName = document.getElementById('displayNameInput').value.trim();
        const errorEl = document.getElementById('authError');
        const btn = document.getElementById('authBtn');
        
        errorEl.textContent = '';
        
        if (!email || !password) {
          errorEl.textContent = 'Please fill in all fields';
          return;
        }
        
        if (isSignUpMode && !displayName) {
          errorEl.textContent = 'Please enter a display name';
          return;
        }
        
        btn.disabled = true;
        btn.textContent = isSignUpMode ? 'Signing up...' : 'Logging in...';
        
        try {
          if (isSignUpMode) {
            // Sign up
            const userCredential = await auth.createUserWithEmailAndPassword(email, password);
            // Create user data in database
            await usersRef.child(userCredential.user.uid).set({
              name: displayName,
              neeks: 0,
              email: email,
              joinedAt: Date.now()
            });
          } else {
            // Log in
            await auth.signInWithEmailAndPassword(email, password);
          }
          
          // Clear inputs
          document.getElementById('emailInput').value = '';
          document.getElementById('authPasswordInput').value = '';
          document.getElementById('displayNameInput').value = '';
          
        } catch (error) {
          let message = 'An error occurred';
          switch (error.code) {
            case 'auth/email-already-in-use':
              message = 'Email already in use';
              break;
            case 'auth/invalid-email':
              message = 'Invalid email address';
              break;
            case 'auth/weak-password':
              message = 'Password must be at least 6 characters';
              break;
            case 'auth/user-not-found':
              message = 'No account found with this email';
              break;
            case 'auth/wrong-password':
              message = 'Incorrect password';
              break;
            case 'auth/invalid-credential':
              message = 'Invalid email or password';
              break;
            default:
              message = error.message;
          }
          errorEl.textContent = message;
        }
        
        btn.disabled = false;
        btn.textContent = isSignUpMode ? 'Sign Up' : 'Log In';
      }

      window.handleLogout = async function() {
        try {
          await auth.signOut();
        } catch (error) {
          console.error('Logout error:', error);
        }
      }

      window.handleNeek = async function() {
        if (!currentUser || isClicking) return;
        
        // Check for cooldown
        if (isCoolingDown) return;
        
        // Check for autoclicker
        if (detectAutoclicker()) {
          triggerCooldown();
          return;
        }
        
        isClicking = true;

        const btn = document.getElementById('neekBtn');
        btn.classList.add('clicking');

        try {
          // Increment global counter
          await counterRef.transaction((current) => (current || 0) + 1);
          
          // Increment user's neek count
          await usersRef.child(currentUser.uid).child('neeks').transaction((current) => (current || 0) + 1);
          
        } catch (error) {
          console.error('Failed to neek:', error);
        }

        setTimeout(() => {
          btn.classList.remove('clicking');
          isClicking = false;
        }, 150);
      }

      window.showResetPanel = function() {
        document.getElementById('adminLink').classList.add('hidden');
        document.getElementById('resetPanel').classList.remove('hidden');
      }

      window.hideResetPanel = function() {
        document.getElementById('adminLink').classList.remove('hidden');
        document.getElementById('resetPanel').classList.add('hidden');
        document.getElementById('resetPasswordInput').value = '';
        document.getElementById('errorText').classList.add('hidden');
        document.getElementById('resetPanel').classList.remove('error');
        document.getElementById('resetPasswordInput').classList.remove('error');
      }

      window.handleReset = async function() {
        const password = document.getElementById('resetPasswordInput').value;
        
        if (password !== RESET_PASSWORD) {
          document.getElementById('errorText').classList.remove('hidden');
          document.getElementById('resetPanel').classList.add('error');
          document.getElementById('resetPasswordInput').classList.add('error');
          
          setTimeout(() => {
            document.getElementById('errorText').classList.add('hidden');
            document.getElementById('resetPanel').classList.remove('error');
            document.getElementById('resetPasswordInput').classList.remove('error');
          }, 2000);
          return;
        }

        try {
          await counterRef.set(0);
          const snapshot = await usersRef.once('value');
          const users = snapshot.val() || {};
          const updates = {};
          Object.keys(users).forEach(key => {
            updates[key + '/neeks'] = 0;
          });
          if (Object.keys(updates).length > 0) {
            await usersRef.update(updates);
          }
          hideResetPanel();
        } catch (error) {
          console.error('Failed to reset:', error);
        }
      }
    });
  </script>
</body>
</html>
